<!--
 * @Description: 
 * @Version: 2.0
 * @Autor: Seven
 * @Date: 2022-09-08 15:28:44
 * @LastEditors: Seven
 * @LastEditTime: 2022-09-15 10:09:13
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
       <p>test</p>
   
</body>

<script>

    function Senddata(){

            //创建一个webSocket实例，执行后，客户端就会与服务端连接
            var ws = new WebSocket("ws://127.0.0.1:8080"); 
        
        //当WebSocket创建成功时，触发onopen事件
        ws.onopen = function(){
            console.log("open");
            // 复杂的数据结构，在通过连接发送之前，必须进行序列化。 
            const json = JSON.stringify({
                weather: 'keepalive',
                vehicle_list: [
                    {"vehicle_id":1,"pose_x":13,"pose_y":3,"velocity":210,"heading":610},
                    {"vehicle_id":2,"pose_x":1,"pose_y":3,"velocity":20,"heading":60},
            ],
                Light_list: [
                    {"Light_id":1,"Light_pose_x":12,"Light_pose_y":3,"Light_status":30},
                    {"Light_id":2,"Light_pose_x":1,"Light_pose_y":3,"Light_status":20},
            ]
            });
            ws.send(json);
            
        　 //将消息发送到服务端
        }
        
        //当客户端收到服务端发来的消息时，触发onmessage事件
        ws.onmessage = function(e){
            //e.data 的数据格式也是字符串，手动解析这些数据才能得到其他格式的数据。
            
        　　console.log(e.data);
        }
        
        //当客户端收到服务端发送的关闭连接请求时，触发onclose事件
        ws.onclose = function(e){
        　　console.log("close");
        }
        
        //如果出现连接、处理、接收、发送数据失败的时候触发onerror事件
        ws.onerror = function(e){
        　　console.log(error);
        }


    }
       
    setInterval(Senddata,1000);

</script>

</html>